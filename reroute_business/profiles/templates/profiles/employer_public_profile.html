{% extends "base.html" %}
{% load static %}
{% load profile_extras %}

{% block title %}Employer Profile{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/employer_public_profile.css' %}">
{% endblock %}

{% block content %}
<div class="employer-public" data-company="{{ employer_profile.company_name|default:'Your Company' }}">
  <section class="hero profile-hero">
    {% if employer_profile.background_image %}
      <div class="hero-bg" style="background-image: url('{{ employer_profile.background_image.url }}?v={{ employer_profile.background_image|file_version }}');"></div>
    {% elif employer_profile.logo %}
      <div class="hero-bg" style="background-image: url('{{ employer_profile.logo.url }}?v={{ employer_profile.logo|file_version }}');"></div>
    {% else %}
      <div class="hero-bg hero-bg--color"></div>
      <div class="hero-watermark" style="background-image: url('{% static 'images/reroute-trans-logo.png' %}');"></div>
    {% endif %}
    <div class="hero-gradient"></div>

    <div class="profile-hero-content">
      <div class="hero-top">
        <div class="hero-left">
          <div class="profile-avatar profile-avatar--employer">
            {% if employer_profile.logo %}
              <img class="hero-logo" src="{{ employer_profile.logo.url }}?v={{ employer_profile.logo|file_version }}" alt="{{ employer_profile.company_name|default:'Company' }} logo">
            {% else %}
              <span class="profile-avatar__initials" aria-hidden="true">
                {% with first=employer_profile.company_name|default:'Y'|slice:":1" %}{{ first|upper }}{% endwith %}
              </span>
            {% endif %}
          </div>
          <div class="hero-meta">
            <h1 class="hero-name">{{ employer_profile.company_name|default:"Your Company" }}</h1>
            <p class="hero-headline">Fair-chance employer profile on ReRoute</p>
            <div class="hero-status-row">
              {% if has_approved_job %}
                <span class="directory-verified-pill">
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <circle cx="12" cy="12" r="9" fill="currentColor"></circle>
                    <path d="M9 12.2 11 14.2 15 10.2" fill="none" stroke="#ffffff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                  <span>Verified</span>
                </span>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="hero-right">
          {% if request.user.is_authenticated and request.user == viewed_user %}
            <div class="hero-actions">
              <a class="btn btn-outline" href="{% url 'dashboard:employer_company_profile' %}">
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 20h4l10-10-4-4L4 16v4z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="M13 6l4 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                Edit Profile
              </a>
            </div>
          {% endif %}
        </div>
      </div>

      <div class="hero-divider"></div>

      <div class="metrics-row">
        <div class="metric">
          <span class="metric-icon">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2h3a2 2 0 0 1 2 2v10a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V8a2 2 0 0 1 2-2h3Zm2 0h4V4h-4v2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
          </span>
          <div>
            <span class="metric-value">{{ total_jobs|default:0 }}</span>
            <span class="metric-label">Openings Posted</span>
          </div>
        </div>
        <div class="metric">
          <span class="metric-icon">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12s4-7 9-7 9 7 9 7-4 7-9 7-9-7-9-7Z" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          </span>
          <div>
            <span class="metric-value">{% if has_approved_job %}Public{% else %}Limited{% endif %}</span>
            <span class="metric-label">Visibility</span>
          </div>
        </div>
        <div class="metric">
          <span class="metric-icon">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 21s-6-4.35-6-10a6 6 0 0 1 12 0c0 5.65-6 10-6 10Z" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="11" r="2.5" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          </span>
          <div>
            <span class="metric-value">{{ employer_profile.user.profile.city|default:"—" }}</span>
            <span class="metric-label">Primary Location</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="profile-sections">
    <article class="profile-card">
      <div class="info-header">
        <h2 class="section-title">About Us</h2>
        {% if request.user.is_authenticated and request.user == viewed_user %}
          <a class="edit-btn" href="{% url 'dashboard:employer_company_profile' %}">Edit</a>
        {% endif %}
      </div>
      <div class="about-text">
        {{ employer_profile.description|default:"Tell candidates about your mission, culture, and values."|linebreaksbr }}
      </div>
    </article>

    <article class="profile-card">
      <div class="section-head">
        <h2 class="section-title">Current Job Openings</h2>
        {% if request.user.is_authenticated and request.user == viewed_user %}
          <a class="btn-view-all" href="{% url 'create_job' %}">Create Job</a>
        {% endif %}
      </div>
      {% if jobs and jobs|length > 0 %}
        <div class="jobs-grid">
          {% for job in jobs %}
            <a class="job-card" href="{% url 'job_detail' job.id %}">
              <div class="job-card-inner">
                <div class="job-title">{{ job.title }}</div>
                <div class="job-meta">
                  <span class="chip">{{ job.get_job_type_display }}</span>
                  <span class="dot">•</span>
                  <span class="location">{{ job.location }}</span>
                </div>
                <div class="job-cta-row"><span class="job-apply-btn">View Role</span></div>
              </div>
            </a>
          {% endfor %}
        </div>
        {% if total_jobs and total_jobs > 3 and view_all_url %}
          <div class="view-all-wrap">
            <a class="btn-view-all" href="{{ view_all_url }}">View All Jobs by {{ employer_profile.company_name|default:'You' }}</a>
          </div>
        {% endif %}
      {% else %}
        <p class="muted">You don’t have any active job openings yet.</p>
      {% endif %}
    </article>

    <article class="profile-card">
      <div class="info-header">
        <h2 class="section-title">Additional Info</h2>
        {% if request.user.is_authenticated and request.user == viewed_user %}
          <a class="edit-btn" href="{% url 'dashboard:employer_company_profile' %}">Edit</a>
        {% endif %}
      </div>
      <div class="info-grid info-grid--plain">
        <div class="info-item">
          <div class="label">Address</div>
          <div class="value">
            {% if employer_profile.user.profile.street_address or employer_profile.user.profile.city or employer_profile.user.profile.state %}
              {{ employer_profile.user.profile.street_address }}{% if employer_profile.user.profile.city %}, {{ employer_profile.user.profile.city }}{% endif %}{% if employer_profile.user.profile.state %}, {{ employer_profile.user.profile.state }}{% endif %}
            {% else %}
              <span class="muted">—</span>
            {% endif %}
          </div>
        </div>
        <div class="info-item">
          <div class="label">Location</div>
          <div class="value">
            {% if employer_profile.user.profile.city or employer_profile.user.profile.state %}
              {{ employer_profile.user.profile.city }}{% if employer_profile.user.profile.city and employer_profile.user.profile.state %}, {% endif %}{{ employer_profile.user.profile.state }}
            {% else %}
              <span class="muted">—</span>
            {% endif %}
          </div>
        </div>
        <div class="info-item">
          <div class="label">Contact number</div>
          <div class="value">
            {% if employer_profile.user.profile.phone_number %}
              {{ employer_profile.user.profile.phone_number }}
            {% else %}
              <span class="muted">—</span>
            {% endif %}
          </div>
        </div>
        <div class="info-item">
          <div class="label">Website</div>
          <div class="value">
            {% if employer_profile.website %}
              <a href="{{ employer_profile.website }}" target="_blank" rel="noopener">{{ employer_profile.website }}</a>
            {% else %}
              <span class="muted">—</span>
            {% endif %}
          </div>
        </div>
      </div>
    </article>
  </section>

</div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/employer_public_profile.js' %}"></script>
{% endblock %}
