{% extends "base.html" %}
{% load static %}

{% block title %}ReRoute | Resume Review{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'resumes/css/resume_flow.css' %}">
  <link rel="stylesheet" href="{% static 'resumes/css/created_resume_view.css' %}">
{% endblock %}

{% block content %}
<section class="resume-flow">
  <div class="page-shell">
    {% include "resumes/partials/step_progress.html" %}

    <div class="resume-card review-card">
      <div class="review-intro">
        <div class="review-check">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="1.6"/>
            <path d="M7.5 12.5l3 3 6-6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h2>Looking good!</h2>
        <p class="lead">Here's how your resume looks. You can edit any section by clicking the edit buttons.</p>
      </div>

      <div class="review-actions">
        <a href="{% url 'resumes:resume_basics_step' %}" class="resume-btn secondary">
          <span aria-hidden="true">✎</span> Edit Basics
        </a>
        <a href="{% url 'resumes:resume_experience_step' %}" class="resume-btn secondary">
          <span aria-hidden="true">✎</span> Edit Experience
        </a>
        <a href="{% url 'resumes:resume_skills_step' %}" class="resume-btn secondary">
          <span aria-hidden="true">✎</span> Edit Skills
        </a>
        <a href="{% url 'resumes:resume_education_step' %}" class="resume-btn secondary">
          <span aria-hidden="true">✎</span> Edit Education
        </a>
      </div>

      <div class="review-preview">
        {% include "resumes/reroute.html" %}
      </div>

      <div class="review-reorder">
        <h3>Reorder sections</h3>
        <ul class="drag-list" data-reorder="sections">
          {% for section in section_order %}
            <li class="drag-item" data-id="{{ section }}" draggable="true">
              <span>{{ section|title }}</span>
              <span class="drag-handle">drag</span>
            </li>
          {% endfor %}
        </ul>

        <h3>Reorder experience</h3>
        <ul class="drag-list" data-reorder="experience">
          {% for role in experiences %}
            <li class="drag-item" data-id="{{ role.id }}" draggable="true">
              <span>{{ role.job_title|default:"Role" }}</span>
              <span class="drag-handle">drag</span>
            </li>
          {% empty %}
            <li class="drag-item">No roles yet</li>
          {% endfor %}
        </ul>

        <h3>Reorder education</h3>
        <ul class="drag-list" data-reorder="education">
          {% for edu in educations %}
            <li class="drag-item" data-id="{{ edu.id }}" draggable="true">
              <span>{{ edu.school|default:"Education" }}</span>
              <span class="drag-handle">drag</span>
            </li>
          {% empty %}
            <li class="drag-item">No education yet</li>
          {% endfor %}
        </ul>
      </div>

      <form method="post" class="review-save">
        {% csrf_token %}
        <input type="hidden" name="action" value="save">
        <button type="submit" class="resume-btn primary">Save Resume -></button>
      </form>
    </div>
  </div>
</section>

<script>
  document.body.dataset.reorderUrl = "{% url 'resumes:resume_review_reorder' %}";
</script>
<script src="{% static 'resumes/js/resume_autosave.js' %}"></script>
<script src="{% static 'resumes/js/review_step.js' %}"></script>
{% endblock %}
