{% extends "base.html" %}
{% load static %}

{% block title %}ReRoute | Resume Education{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'resumes/css/resume_flow.css' %}">
{% endblock %}

{% block content %}
<section class="resume-flow">
  <div class="page-shell">
    {% include "resumes/partials/step_progress.html" %}

    <div class="resume-card">
      <h2>Education & Training</h2>
      <p class="lead">Add anything that strengthens your story. You can skip this for now.</p>

      <form method="post" data-autosave-url="{% url 'resumes:resume_education_autosave' %}">
        {% csrf_token %}
        {{ formset.management_form }}

        <div data-education-list>
          {% for form in formset %}
            <div class="education-card" data-education-id="{{ form.instance.id|default:'' }}">
              <header>
                <strong>Entry {{ forloop.counter }}</strong>
                <button type="button" class="resume-btn secondary" data-remove-education>Remove</button>
              </header>
              {{ form.id }}
              <div style="display:none;">
                {{ form.DELETE }}
              </div>
              <div class="resume-form-grid">
                <div class="form-field">
                  <label>Type</label>
                  {{ form.education_type }}
                  {{ form.education_type.errors }}
                </div>
                <div class="form-field">
                  <label>School/Organization</label>
                  {{ form.school }}
                </div>
                <div class="form-field">
                  <label>Field/Subject</label>
                  {{ form.field_of_study }}
                </div>
                <div class="form-field">
                  <label>Year</label>
                  {{ form.year }}
                  {{ form.year.errors }}
                </div>
                <div class="form-field" style="grid-column: 1 / -1;">
                  <label>Details (optional)</label>
                  {{ form.details }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <button type="button" class="resume-btn secondary" data-add-education>+ Add another entry</button>

        <div class="resume-step-footer">
          <a href="{% url 'resumes:resume_skills_step' %}" class="resume-btn secondary">Back</a>
          <div>
            <span class="resume-saved" data-saved-text></span>
            <button type="submit" class="resume-btn primary">Continue</button>
            <button type="submit" name="skip" value="1" class="resume-btn secondary">Skip for now</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>

<template id="education-template">
  <div class="education-card" data-education-id="">
    <header>
      <strong>New Entry</strong>
      <button type="button" class="resume-btn secondary" data-remove-education>Remove</button>
    </header>
    <div class="resume-form-grid">
      <div class="form-field">
        <label>Type</label>
        <select name="new-education_type" class="form-control">
          <option value="">Select</option>
          {% for opt in education_types %}
            <option value="{{ opt.id }}">{{ opt.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-field">
        <label>School/Organization</label>
        <input type="text" name="new-school" class="form-control">
      </div>
      <div class="form-field">
        <label>Field/Subject</label>
        <input type="text" name="new-field_of_study" class="form-control">
      </div>
      <div class="form-field">
        <label>Year</label>
        <input type="text" name="new-year" class="form-control" inputmode="numeric" maxlength="4">
      </div>
      <div class="form-field" style="grid-column: 1 / -1;">
        <label>Details (optional)</label>
        <textarea name="new-details" class="form-control" rows="3"></textarea>
      </div>
    </div>
  </div>
</template>

<script src="{% static 'resumes/js/resume_autosave.js' %}"></script>
<script src="{% static 'resumes/js/education_step.js' %}"></script>
{% endblock %}
