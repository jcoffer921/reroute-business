{% extends "base.html" %}
{% load static %}

{% block title %}ReRoute | Resume Experience{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'resumes/css/resume_flow.css' %}">
{% endblock %}

{% block content %}
<section class="resume-flow">
  <div class="page-shell">
    {% include "resumes/partials/step_progress.html" %}

    <div class="resume-card">
      <h2>Experience</h2>
      <p class="lead">Add your work, programs, or other experience. One role per card.</p>

      <form method="post" data-autosave-url="{% url 'resumes:resume_experience_autosave' %}">
        {% csrf_token %}
        {{ formset.management_form }}

        <div data-role-list>
          {% for form in formset %}
            <div class="role-card" data-role-id="{{ form.instance.id|default:'' }}">
              <header>
                <strong>Role {{ forloop.counter }}</strong>
                <button type="button" class="resume-btn secondary" data-remove-role>Remove</button>
              </header>
              {{ form.id }}
              <div style="display:none;">
                {{ form.DELETE }}
              </div>
              <div class="resume-form-grid">
                <div class="form-field">
                  <label>Role Type</label>
                  {{ form.role_type }}
                </div>
                <div class="form-field">
                  <label>Job Title</label>
                  {{ form.job_title }}
                  {{ form.job_title.errors }}
                </div>
                <div class="form-field">
                  <label>Company/Organization</label>
                  {{ form.company }}
                  {{ form.company.errors }}
                </div>
                <div class="form-field">
                  <label>Start Year</label>
                  {{ form.start_year }}
                </div>
                <div class="form-field">
                  <label>End Year</label>
                  {{ form.end_year }}
                </div>
                <div class="form-field">
                  <label>Currently work here</label>
                  {{ form.currently_work_here }}
                </div>
                <div class="form-field" style="grid-column: 1 / -1;">
                  <label>Responsibilities</label>
                  {{ form.responsibilities }}
                  {{ form.responsibilities.errors }}
                </div>
                <div class="form-field" style="grid-column: 1 / -1;">
                  <label>Tools/Equipment (optional)</label>
                  {{ form.tools }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <button type="button" class="resume-btn secondary" data-add-role>+ Add another role</button>

        <div class="resume-step-footer">
          <a href="{% url 'resumes:resume_basics_step' %}" class="resume-btn secondary">Back</a>
          <div>
            <span class="resume-saved" data-saved-text></span>
            <button type="submit" class="resume-btn primary">Continue</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>

<template id="role-template">
  <div class="role-card" data-role-id="">
    <header>
      <strong>New Role</strong>
      <button type="button" class="resume-btn secondary" data-remove-role>Remove</button>
    </header>
    <div class="resume-form-grid">
      <div class="form-field">
        <label>Role Type</label>
        <select name="new-role_type" class="form-control">
          <option value="job">Job</option>
          <option value="other">Other experience / programs</option>
        </select>
      </div>
      <div class="form-field">
        <label>Job Title</label>
        <input type="text" name="new-job_title" class="form-control">
      </div>
      <div class="form-field">
        <label>Company/Organization</label>
        <input type="text" name="new-company" class="form-control">
      </div>
      <div class="form-field">
        <label>Start Year</label>
        <input type="text" name="new-start_year" class="form-control" inputmode="numeric" maxlength="4">
      </div>
      <div class="form-field">
        <label>End Year</label>
        <input type="text" name="new-end_year" class="form-control" inputmode="numeric" maxlength="4">
      </div>
      <div class="form-field">
        <label>Currently work here</label>
        <input type="checkbox" name="new-currently_work_here" class="form-check-input">
      </div>
      <div class="form-field" style="grid-column: 1 / -1;">
        <label>Responsibilities</label>
        <textarea name="new-responsibilities" class="form-control" rows="4"></textarea>
      </div>
      <div class="form-field" style="grid-column: 1 / -1;">
        <label>Tools/Equipment (optional)</label>
        <textarea name="new-tools" class="form-control" rows="2"></textarea>
      </div>
    </div>
  </div>
</template>

<script src="{% static 'resumes/js/resume_autosave.js' %}"></script>
<script src="{% static 'resumes/js/experience_step.js' %}"></script>
{% endblock %}
