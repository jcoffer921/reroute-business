{% extends "base.html" %}
{% load static %}

{% block title %}ReRoute | Resume Experience{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'resumes/css/resume_flow.css' %}">
{% endblock %}

{% block content %}
<section class="resume-flow">
  <div class="page-shell">
    {% include "resumes/partials/step_progress.html" %}

    <div class="resume-card experience-card">
      <h2>Your experience</h2>
      <p class="lead">One role at a time. Dates are optional â€” focus on what you did.</p>

      <form method="post" data-autosave-url="{% url 'resumes:resume_experience_autosave' %}">
        {% csrf_token %}
        {{ formset.management_form }}

        <div data-role-list>
          {% for form in formset %}
            <div class="role-card {% if forloop.first %}is-active{% endif %}" data-role-id="{{ form.instance.id|default:'' }}">
              <header>
                <div class="role-title">
                  <span class="role-icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24">
                      <path d="M6 7h12v12H6zM9 5h6v2H9z" fill="none" stroke="currentColor" stroke-width="1.6"/>
                    </svg>
                  </span>
                  <strong>Role {{ forloop.counter }}</strong>
                </div>
                <button type="button" class="resume-btn secondary" data-remove-role>Remove</button>
              </header>
              {{ form.id }}
              <div style="display:none;">
                {{ form.DELETE }}
              </div>
              <div class="resume-form-grid">
                <div class="form-field">
                  <label class="resume-label">
                    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 7h16M7 12h10M9 17h6" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
                    Role Type
                  </label>
                  {{ form.role_type }}
                </div>
                <div class="form-field">
                  <label class="resume-label">
                    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 7h8M6 7h12v12H6z" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
                    Job Title
                  </label>
                  {{ form.job_title }}
                  {{ form.job_title.errors }}
                </div>
                <div class="form-field">
                  <label class="resume-label">
                    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 21V7l8-4 8 4v14M8 21v-6h8v6" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
                    Company/Organization
                  </label>
                  {{ form.company }}
                  {{ form.company.errors }}
                </div>
                <div class="form-field two-col">
                  <div>
                    <label class="resume-label">
                      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M5 5h14v14H5zM8 3v4M16 3v4M5 9h14" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
                      Start (optional)
                    </label>
                    {{ form.start_year }}
                  </div>
                  <div>
                    <label class="resume-label">
                      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M5 5h14v14H5zM8 3v4M16 3v4M5 9h14" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
                      End (optional)
                    </label>
                    {{ form.end_year }}
                  </div>
                </div>
                <div class="form-field">
                  <label class="resume-label">
                    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 12l4 4 12-12" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
                    Currently work here
                  </label>
                  {{ form.currently_work_here }}
                </div>
                <div class="form-field" style="grid-column: 1 / -1;">
                  <label class="resume-label">
                    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 7h12M6 12h12M6 17h8" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
                    What did you do?
                  </label>
                  {{ form.responsibilities }}
                  {{ form.responsibilities.errors }}
                </div>
                <div class="form-field" style="grid-column: 1 / -1;">
                  <label class="resume-label">
                    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 21l6-6M14 7l3-3 4 4-3 3" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
                    Tools / Equipment (optional)
                  </label>
                  {{ form.tools }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="role-nav" data-role-nav>
          <button type="button" class="resume-btn secondary" data-role-prev>Previous</button>
          <span class="role-count" data-role-count></span>
          <button type="button" class="resume-btn secondary" data-role-next>Next</button>
        </div>

        <button type="button" class="resume-btn secondary dashed-btn" data-add-role>
          <span aria-hidden="true">+</span> Add another role
        </button>

        <div class="resume-step-footer">
          <a href="{% url 'resumes:resume_basics_step' %}" class="resume-btn secondary">
            <- Back
          </a>
          <div>
            <span class="resume-saved" data-saved-text></span>
            <button type="submit" class="resume-btn primary">Continue -></button>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>

<template id="role-template">
  <div class="role-card" data-role-id="">
    <header>
      <strong>New Role</strong>
      <button type="button" class="resume-btn secondary" data-remove-role>Remove</button>
    </header>
      <div class="resume-form-grid">
      <div class="form-field">
        <label class="resume-label">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 7h16M7 12h10M9 17h6" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
          Role Type
        </label>
        <select name="new-role_type" class="form-control">
          <option value="job">Job</option>
          <option value="other">Other experience / programs</option>
        </select>
      </div>
      <div class="form-field">
        <label class="resume-label">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 7h8M6 7h12v12H6z" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
          Job Title
        </label>
        <input type="text" name="new-job_title" class="form-control">
      </div>
      <div class="form-field">
        <label class="resume-label">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 21V7l8-4 8 4v14M8 21v-6h8v6" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
          Company/Organization
        </label>
        <input type="text" name="new-company" class="form-control">
      </div>
      <div class="form-field">
        <label class="resume-label">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M5 5h14v14H5zM8 3v4M16 3v4M5 9h14" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
          Start Year
        </label>
        <input type="text" name="new-start_year" class="form-control" inputmode="numeric" maxlength="4">
      </div>
      <div class="form-field">
        <label class="resume-label">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M5 5h14v14H5zM8 3v4M16 3v4M5 9h14" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
          End Year
        </label>
        <input type="text" name="new-end_year" class="form-control" inputmode="numeric" maxlength="4">
      </div>
      <div class="form-field">
        <label class="resume-label">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 12l4 4 12-12" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
          Currently work here
        </label>
        <input type="checkbox" name="new-currently_work_here" class="form-check-input">
      </div>
      <div class="form-field" style="grid-column: 1 / -1;">
        <label class="resume-label">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 7h12M6 12h12M6 17h8" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
          Responsibilities
        </label>
        <textarea name="new-responsibilities" class="form-control" rows="4"></textarea>
      </div>
      <div class="form-field" style="grid-column: 1 / -1;">
        <label class="resume-label">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 21l6-6M14 7l3-3 4 4-3 3" fill="none" stroke="currentColor" stroke-width="1.6"/></svg>
          Tools/Equipment (optional)
        </label>
        <textarea name="new-tools" class="form-control" rows="2"></textarea>
      </div>
    </div>
  </div>
</template>

<script src="{% static 'resumes/js/resume_autosave.js' %}"></script>
<script src="{% static 'resumes/js/experience_step.js' %}"></script>
{% endblock %}
