{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Resources Directory | ReRoute" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'resources/css/directory.css' %}">
{% endblock %}

{% block content %}
<section class="directory-page" id="directoryApp">
  <div class="directory-shell">
    <header class="directory-header">
      <h1>{% trans "Resources Directory" %}</h1>
      <p>{% trans "Find trusted programs and services in Philadelphia." %}</p>
      {% if selected_zip %}
      <p class="directory-zip-banner">{% blocktrans with zip=selected_zip %}Showing results near {{ zip }}{% endblocktrans %}</p>
      {% endif %}
    </header>

    <div class="directory-controls">
      <label class="directory-search" for="directorySearchInput">
        <span class="sr-only">{% trans "Search resources" %}</span>
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <circle cx="11" cy="11" r="7"></circle>
          <path d="m16.5 16.5 4 4"></path>
        </svg>
        <input id="directorySearchInput" type="search" placeholder="{% trans 'Search resources...' %}" autocomplete="off">
      </label>
      <button class="directory-filter-toggle" id="directoryFilterToggle" type="button" aria-controls="directoryFiltersPanel" aria-expanded="false">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M4 7h16M7 12h10M10 17h4"></path>
        </svg>
        {% trans "Filters" %}
      </button>
    </div>

    <div class="directory-filter-backdrop" id="directoryFilterBackdrop" hidden></div>

    <section class="directory-filters" id="directoryFiltersPanel" aria-label="{% trans 'Resource filters' %}">
      <div class="directory-filters-header">
        <h2>{% trans "Filters" %}</h2>
        <div class="directory-filters-header-actions">
          <button type="button" id="directoryClearFilters" class="directory-clear-btn">{% trans "Clear all" %}</button>
          <button type="button" id="directoryCloseFilters" class="directory-close-btn" aria-label="{% trans 'Close filters' %}">✕</button>
        </div>
      </div>

      <div class="directory-filter-group" role="group" aria-label="{% trans 'Filter by category' %}">
        <h3>{% trans "Category" %}</h3>
        <div class="directory-chip-wrap">
          {% for category in filter_categories %}
          <button type="button" class="directory-chip" data-filter-kind="category" data-filter-value="{{ category }}" aria-pressed="false">{{ category }}</button>
          {% endfor %}
        </div>
      </div>

      <div class="directory-filter-group" role="group" aria-label="{% trans 'Filter by feature' %}">
        <h3>{% trans "Features" %}</h3>
        <div class="directory-chip-wrap">
          {% for feature in filter_features %}
          <button type="button" class="directory-chip" data-filter-kind="feature" data-filter-value="{{ feature }}" aria-pressed="false">{{ feature }}</button>
          {% endfor %}
        </div>
      </div>
    </section>

    <p id="directoryResultsMeta" class="directory-results-meta" aria-live="polite">{% blocktrans with count=resources|length %}Showing {{ count }} resources{% endblocktrans %}</p>

    <div class="directory-grid" id="directoryGrid">
      {% for resource in resources %}
      <article class="directory-card"
        data-directory-card
        data-categories="{{ resource.categories|join:'||' }}"
        data-features="{{ resource.features|join:'||' }}"
        data-card-url="{% url 'resource_directory_detail' resource.slug %}"
        data-search="{{ resource.name }} {{ resource.overview }} {{ resource.address_line }} {{ resource.neighborhood }} {{ resource.categories|join:' ' }} {{ resource.features|join:' ' }} {{ resource.hours }} {{ resource.phone }}">
        <a class="directory-card-overlay-link" href="{% url 'resource_directory_detail' resource.slug %}" aria-label="{% blocktrans with name=resource.name %}View details for {{ name }}{% endblocktrans %}">
          <span class="sr-only">{% blocktrans with name=resource.name %}View details for {{ name }}{% endblocktrans %}</span>
        </a>

        <div class="directory-card-content">
          <h2 class="directory-card-title">{{ resource.name }}</h2>

          <div class="directory-tag-row">
            {% for tag in resource.card_tags %}
            <span class="directory-tag{% if tag in resource.categories %} directory-tag--category{% endif %}">{{ tag }}</span>
            {% endfor %}
            {% if resource.hidden_tag_count %}
            <span class="directory-tag directory-tag--overflow" aria-hidden="true">+{{ resource.hidden_tag_count }}</span>
            {% endif %}
          </div>

          <p class="directory-overview">{{ resource.overview }}</p>

          <ul class="directory-meta">
            <li>
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M12 21s7-6.2 7-11a7 7 0 1 0-14 0c0 4.8 7 11 7 11Zm0-8a3 3 0 1 1 0-6 3 3 0 0 1 0 6Z"></path></svg>
              <span>{{ resource.address_line }} · {{ resource.neighborhood }}</span>
            </li>
            <li>
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><rect x="5" y="4" width="14" height="14" rx="2"></rect><path d="M8 18v2M16 18v2M5 9h14M9 13h2M13 13h2"></path></svg>
              <span>{{ resource.transit_line }}</span>
            </li>
            <li>
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><circle cx="12" cy="12" r="8"></circle><path d="M12 7v5l3 2"></path></svg>
              <span>{{ resource.hours }}</span>
            </li>
            <li>
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M7 4h3l2 5-2 1a13 13 0 0 0 4 4l1-2 5 2v3a2 2 0 0 1-2.3 2A16 16 0 0 1 5 6.3 2 2 0 0 1 7 4Z"></path></svg>
              <a class="directory-phone-link" href="tel:{{ resource.phone_href }}">{{ resource.phone }}</a>
            </li>
          </ul>

          <section class="directory-expectation">
            <h3>{% trans "What to expect" %}</h3>
            <p>{{ resource.what_to_expect }}</p>
          </section>
        </div>
      </article>
      {% endfor %}
    </div>

    {% if page_obj and page_obj.paginator.num_pages > 1 %}
    <nav class="directory-pagination" aria-label="{% trans 'Resource directory pages' %}">
      {% if page_obj.has_previous %}
      <a class="directory-page-link" href="?page={{ page_obj.previous_page_number }}{% if pagination_query %}&{{ pagination_query }}{% endif %}">{% trans "Previous" %}</a>
      {% else %}
      <span class="directory-page-link directory-page-link--disabled" aria-disabled="true">{% trans "Previous" %}</span>
      {% endif %}

      <span class="directory-page-status">{% blocktrans with number=page_obj.number total=page_obj.paginator.num_pages %}Page {{ number }} of {{ total }}{% endblocktrans %}</span>

      {% if page_obj.has_next %}
      <a class="directory-page-link" href="?page={{ page_obj.next_page_number }}{% if pagination_query %}&{{ pagination_query }}{% endif %}">{% trans "Next" %}</a>
      {% else %}
      <span class="directory-page-link directory-page-link--disabled" aria-disabled="true">{% trans "Next" %}</span>
      {% endif %}
    </nav>
    {% endif %}

    <p id="directoryNoResults" class="directory-no-results" hidden>{% trans "No resources matched your search and selected filters." %}</p>

    <section class="directory-disclaimer" aria-label="{% trans 'Disclaimer' %}">
      <p>{{ directory_disclaimer }}</p>
      <p>{% trans "If you notice incorrect information," %} <a href="{% url 'contact' %}">{% trans "please report it" %}</a>.</p>
    </section>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'resources/js/directory.js' %}" defer></script>
{% endblock %}
