{% extends "base.html" %}
{% load static %}

{% block title %}ReRoute | {{ module.title }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'resources/css/module_detail.css' %}">

<div class="mod-container">
  <div class="mod-flex">
    <!-- Left: Quiz -->
    <aside class="mod-left mod-sticky">
      <div class="quiz-title">Knowledge Check</div>
      <div id="quizPanel" data-quiz-url="{% url 'module_quiz_schema' module.id %}"></div>
      <div class="quiz-actions">
        <button id="quizSubmit" class="quiz-submit">Submit Quiz</button>
      </div>
      <div id="quizResult" class="quiz-result"></div>
    </aside>

    <!-- Right: Video + content -->
    <main class="mod-right">
      <div class="mod-video-wrap">
        {% if yt_id %}
          <iframe src="https://www.youtube-nocookie.com/embed/{{ yt_id }}?rel=0&modestbranding=1&playsinline=1"
                  title="Module video" referrerpolicy="strict-origin-when-cross-origin"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        {% elif module.video_url and module.video_url|lower|endswith:'.mp4' %}
          <video controls playsinline preload="metadata">
            <source src="{{ module.video_url }}" type="video/mp4">
          </video>
        {% elif module.embed_html %}
          {{ module.embed_html|safe }}
        {% endif %}
      </div>

      <h1 class="mod-title">{{ module.title }}</h1>
      <p class="mod-desc">{{ module.description }}</p>

      <div class="mod-section">
        <h3>Key Takeaways</h3>
        <div class="mod-notes">
          {% if module.internal_content %}
            {{ module.internal_content|safe }}
          {% else %}
            <ul>
              <li>Watch the video and follow along.</li>
              <li>Use the quiz to reinforce your learning.</li>
              <li>Revisit sections that need more practice.</li>
            </ul>
          {% endif %}
        </div>
      </div>
    </main>
  </div>
</div>

<script src="{% static 'resources/js/module_quiz_csp.js' %}" defer></script>
{% endblock %}

