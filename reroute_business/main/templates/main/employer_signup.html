{# employers/employer_signup.html #}
{% extends "base.html" %}
{% load static %}
{% load socialaccount %}
{% block title %}Employer Signup{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/employer_login.css' %}"> {# reuse styles #}
<link rel="stylesheet" href="{% static 'css/employer_signup.css' %}"> {# overrides below #}

{% url 'oauth_role_redirect' as oauth_role_redirect_url %}
{% with google_next=oauth_role_redirect_url|add:'?role=employer' %}
  {% provider_login_url "google" process="login" next=google_next as google_login_url %}
  {% with google_login_url=google_login_url|default:"/accounts/google/login/?next="|add:google_next %}

<section class="auth-card auth-card--wide">
  <div
    id="employer-signup-react-root"
    data-action="{% url 'employer_signup' %}"
    data-first-name="{{ prefill.first_name|default:'' }}"
    data-last-name="{{ prefill.last_name|default:'' }}"
    data-email="{{ prefill.email|default:'' }}"
    data-company="{{ prefill.company_name|default:'' }}"
    data-website="{{ prefill.website|default:'' }}"
    data-description="{{ prefill.description|default:'' }}"
    data-errors="{% if errors %}{% for k,v in errors.items %}{{ v }} {% endfor %}{% endif %}"
    data-sitekey="{{ recaptcha_site_key|default:'' }}"
    data-login-url="{% url 'employer_login' %}"
    data-user-signup-url="{% url 'signup' %}"
    data-terms-url="{% url 'terms' %}"
    data-privacy-url="{% url 'privacy' %}"
    data-google-url="{{ google_login_url }}"
    data-google-divider="Or sign up with"
  ></div>

  <div id="employer-signup-fallback">
    <h1 class="auth-title">Create your employer account</h1>
    <p class="subtitle">Post jobs, review applicants, and manage your company profile.</p>
    <p class="micro-hint" style="margin-top:6px">
      Not sure? <a href="{% url 'pricing' %}?tab=employer" class="link">Check our plans first →</a>
    </p>

    <form id="employer-signup-form" method="post" action="{% url 'employer_signup' %}" novalidate>
      {% csrf_token %}

      <!-- ===== Account section ===== -->
      <div class="form-row two-col">
        <div class="form-group">
          <label for="first_name">First name</label>
          <input id="first_name" name="first_name" type="text" required
                 value="{{ prefill.first_name|default:'' }}">
          {% if errors.first_name %}<div class="field-error">{{ errors.first_name }}</div>{% endif %}
        </div>

        <div class="form-group">
          <label for="last_name">Last name</label>
          <input id="last_name" name="last_name" type="text" required
                 value="{{ prefill.last_name|default:'' }}">
          {% if errors.last_name %}<div class="field-error">{{ errors.last_name }}</div>{% endif %}
        </div>
      </div>

      <div class="form-group">
        <label for="email">Work email</label>
        <input id="email" name="email" type="email" inputmode="email" autocomplete="email" required
               placeholder="name@company.com" value="{{ prefill.email|default:'' }}">
        {% if errors.email %}<div class="field-error">{{ errors.email }}</div>{% endif %}
      </div>

      <div class="form-row two-col">
        <div class="form-group">
          <div class="label-row">
            <label for="password1">Password</label>
            <span class="micro-hint" id="pw-hint">Use at least 8 characters.</span>
          </div>
          <div class="pwd-wrap">
            <input id="password1" name="password1" type="password" autocomplete="new-password" required>
            <span class="pwd-toggle-text" tabindex="0" role="button" aria-controls="password1">Show Password</span>
          </div>
          {% if errors.password1 %}<div class="field-error">{{ errors.password1 }}</div>{% endif %}
        </div>

        <div class="form-group">
          <label for="password2">Confirm password</label>
          <div class="pwd-wrap">
            <input id="password2" name="password2" type="password" autocomplete="new-password" required>
            <span class="pwd-toggle-text" tabindex="0" role="button" aria-controls="password2">Show Password</span>
          </div>
          {% if errors.password2 %}<div class="field-error">{{ errors.password2 }}</div>{% endif %}
        </div>
      </div>

      <!-- ===== Company section ===== -->
      <div class="form-group">
        <label for="company_name">Company name</label>
        <input id="company_name" name="company_name" type="text" required
               value="{{ prefill.company_name|default:'' }}">
        {% if errors.company_name %}<div class="field-error">{{ errors.company_name }}</div>{% endif %}
      </div>

      <div class="form-group">
        <label for="website">Website (optional)</label>
        <input id="website" name="website" type="url" placeholder="https://example.com"
               value="{{ prefill.website|default:'' }}">
      </div>

      <div class="form-group">
        <label for="description">Company description (optional)</label>
        <textarea id="description" name="description" rows="4"
                  placeholder="Tell candidates about your mission, team size, and benefits.">{{ prefill.description|default:'' }}</textarea>
      </div>

      <!-- ===== Terms / create button ===== -->
      <div class="agree-row">
        <label class="checkbox">
          <input type="checkbox" name="agree_terms" value="1" {% if prefill %}{% if not errors.agree_terms %}checked{% endif %}{% endif %}>
          <span>I agree to the <a href="{% url 'terms' %}" target="_blank" rel="noopener">Terms</a> and <a href="{% url 'privacy' %}" target="_blank" rel="noopener">Privacy Policy</a>.</span>
        </label>
        {% if errors.agree_terms %}<div class="field-error">{{ errors.agree_terms }}</div>{% endif %}
      </div>

      {% if recaptcha_site_key %}
        <div class="g-recaptcha" data-sitekey="{{ recaptcha_site_key }}"></div>
      {% endif %}
      <button type="submit" class="btn-pill">Create employer account</button>

      <div class="secondary-actions">
        <span>Already have an account? <a class="link" href="{% url 'employer_login' %}">Employer login</a>.</span>
        <span class="sep" aria-hidden="true">·</span>
        <a class="link" href="{% url 'signup' %}">User signup</a>
      </div>
    </form>

    {% include "main/partials/google_auth.html" with divider_text="Or sign up with" google_url=google_login_url %}
  </div>
</section>
  {% endwith %}
{% endwith %}

<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
<script crossorigin src="https://cdn.jsdelivr.net/npm/framer-motion@10.16.4/dist/framer-motion.umd.min.js" defer></script>
<script src="{% static 'js/employer-signup-react.js' %}" defer></script>
{% if recaptcha_site_key %}
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endif %}
{% endblock %}
