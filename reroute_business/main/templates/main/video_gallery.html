{% extends "base.html" %}
{% load static %}

{% block title %}ReRoute | Modules{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'resources/css/resources.css' %}">
<link rel="stylesheet" href="{% static 'resources/css/lesson.css' %}">
<link rel="stylesheet" href="{% static 'resources/css/modules_gallery.css' %}">
{% endblock %}

{% block content %}
<section class="modules-hero" aria-labelledby="modulesHeroHeading">
  <div class="modules-hero__texture" aria-hidden="true"></div>
  <div class="modules-hero__content">
    <p class="modules-hero__badge">
      <span class="modules-hero__badge-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="12" height="12" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
          <path d="M8.4 6.3a1 1 0 0 1 1.5-.9l8 5.2a1.7 1.7 0 0 1 0 2.8l-8 5.2a1 1 0 0 1-1.5-.9V6.3Z" fill="currentColor"/>
        </svg>
      </span>
      SHORT VIDEOS. REAL SKILLS.
    </p>

    <h1 id="modulesHeroHeading" class="modules-hero__title">
      <span class="modules-hero__title-line">Learn what matters.</span>
      <span class="modules-hero__title-line modules-hero__title-line--accent">Take your next step.</span>
    </h1>

    <p class="modules-hero__subtitle">
      Short videos + checklists built for reentry reality - then we connect you to local support.
    </p>

    <div class="modules-hero__actions">
      <a href="#modules-grid" class="modules-hero__btn modules-hero__btn--primary">
        <span class="modules-hero__btn-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
            <path d="M5 4.75A2.75 2.75 0 0 1 7.75 2h8.5A2.75 2.75 0 0 1 19 4.75v14.5A2.75 2.75 0 0 1 16.25 22h-8.5A2.75 2.75 0 0 1 5 19.25V4.75Zm3.4.75a.9.9 0 1 0 0 1.8h7.2a.9.9 0 1 0 0-1.8H8.4Zm0 4a.9.9 0 1 0 0 1.8h7.2a.9.9 0 1 0 0-1.8H8.4Zm0 4a.9.9 0 1 0 0 1.8h4.2a.9.9 0 0 0 0-1.8H8.4Z" fill="currentColor"/>
          </svg>
        </span>
        Browse Modules
      </a>

      <button
        type="button"
        class="modules-hero__btn modules-hero__btn--secondary"
        data-continue-module
        data-fallback-url="{{ first_module_url }}"
      >
        <span class="modules-hero__btn-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
            <path d="M8.4 6.3a1 1 0 0 1 1.5-.9l8 5.2a1.7 1.7 0 0 1 0 2.8l-8 5.2a1 1 0 0 1-1.5-.9V6.3Z" fill="currentColor"/>
          </svg>
        </span>
        Continue where you left off
      </button>
    </div>
    <p class="modules-hero__toast" data-modules-toast role="status" aria-live="polite"></p>
  </div>
</section>

<section class="modules-section">
  <div class="video-library-container">
    <form class="category-filter" method="get" action="{% url 'video_gallery' %}">
      <input type="hidden" name="q" value="{{ active_query }}">
      <input type="hidden" name="duration" value="{{ active_duration }}">
      <input type="hidden" name="language" value="{{ active_language }}">
      <h2 class="category-filter__title">Browse by Category</h2>
      <div class="category-filter__grid" role="list">
        {% for card in category_cards %}
          <button
            type="submit"
            class="category-card{% if card.is_active %} category-card--active{% endif %}"
            name="category"
            value="{{ card.slug }}"
            role="listitem"
            aria-pressed="{% if card.is_active %}true{% else %}false{% endif %}"
          >
            <span class="category-card__icon-badge" aria-hidden="true">
              {% if card.icon == "all" %}
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
                  <rect x="3.5" y="3.5" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="1.6" fill="none"/>
                  <rect x="13.5" y="3.5" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="1.6" fill="none"/>
                  <rect x="3.5" y="13.5" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="1.6" fill="none"/>
                  <rect x="13.5" y="13.5" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="1.6" fill="none"/>
                </svg>
              {% elif card.icon == "ids_documents" %}
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
                  <rect x="3.5" y="4.5" width="17" height="15" rx="2.4" stroke="currentColor" stroke-width="1.6" fill="none"/>
                  <path d="M8 10h8M8 13h5.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                </svg>
              {% elif card.icon == "jobs_interviews" %}
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
                  <rect x="4" y="6.5" width="16" height="12.5" rx="2.2" stroke="currentColor" stroke-width="1.6" fill="none"/>
                  <path d="M9.2 6.5v-1a1.7 1.7 0 0 1 1.7-1.7h2.2a1.7 1.7 0 0 1 1.7 1.7v1M4 11.3h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                </svg>
              {% elif card.icon == "housing" %}
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
                  <path d="M4.8 10.6 12 4.7l7.2 5.9v7.2a1.3 1.3 0 0 1-1.3 1.3H6.1a1.3 1.3 0 0 1-1.3-1.3v-7.2Z" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linejoin="round"/>
                  <path d="M9.5 19v-5h5v5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                </svg>
              {% elif card.icon == "benefits" %}
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
                  <path d="M12 20.2s-6.8-4.2-6.8-9.1a3.9 3.9 0 0 1 6.8-2.5 3.9 3.9 0 0 1 6.8 2.5c0 4.9-6.8 9.1-6.8 9.1Z" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linejoin="round"/>
                </svg>
              {% elif card.icon == "transportation" %}
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
                  <rect x="6" y="4.5" width="12" height="11" rx="2" stroke="currentColor" stroke-width="1.6" fill="none"/>
                  <path d="M8.2 17.5h7.6M9 19.8h.1M14.9 19.8h.1M8.5 8.5h7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                </svg>
              {% elif card.icon == "health_mental_health" %}
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
                  <path d="M6.3 13.7h3l1.8-3.6 2.2 6 1.5-2.4h2.9" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M20 12a8 8 0 1 1-16 0 8 8 0 0 1 16 0Z" stroke="currentColor" stroke-width="1.6" fill="none"/>
                </svg>
              {% elif card.icon == "financial_basics" %}
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
                  <circle cx="12" cy="12" r="8.2" stroke="currentColor" stroke-width="1.6" fill="none"/>
                  <path d="M12 7.4v9.2M9.2 10c0-1 1-1.8 2.8-1.8 1.7 0 2.8.7 2.8 1.8 0 1.1-.9 1.5-2.8 1.8-1.9.3-2.8.8-2.8 1.8 0 1.1 1.1 1.9 2.8 1.9 1.9 0 2.8-.8 2.8-1.9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              {% endif %}
            </span>
            {% if card.pill %}
              <span class="category-card__pill">{{ card.pill }}</span>
            {% endif %}
            <span class="category-card__title">{{ card.title }}</span>
            <span class="category-card__count">{{ card.count_label }}</span>
          </button>
        {% endfor %}
      </div>
    </form>

    <header class="modules-header">
      <h2 class="modules-header__title">
        <span>All Modules</span>
        <span class="modules-header__count">({{ total_count }})</span>
      </h2>
    </header>

    <form class="modules-filters" method="get" action="{% url 'video_gallery' %}" data-modules-filter-form>
      <input type="hidden" name="category" value="{{ active_category }}">
      <label class="modules-search" for="modules-search">
        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false">
          <circle cx="11" cy="11" r="6.5" stroke="currentColor" stroke-width="1.8" fill="none"></circle>
          <path d="m16 16 4 4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path>
        </svg>
        <input
          id="modules-search"
          name="q"
          type="search"
          value="{{ active_query }}"
          placeholder="Search: resume, interview, expungement..."
          autocomplete="off"
        >
      </label>

      <div class="modules-select-wrap">
        <label class="sr-only" for="modules-duration">Any Duration</label>
        <select id="modules-duration" name="duration" data-auto-submit-filter>
          {% for value, label in duration_options %}
            <option value="{{ value }}"{% if active_duration == value %} selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="modules-select-wrap">
        <label class="sr-only" for="modules-language">Any Language</label>
        <select id="modules-language" name="language" data-auto-submit-filter>
          <option value=""{% if not active_language %} selected{% endif %}>Any Language</option>
          {% for value, label in language_options %}
            <option value="{{ value }}"{% if active_language == value %} selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
    </form>

    {% if modules %}
      <div id="modules-grid" class="modules-grid">
        {% for module in modules %}
          <article class="module-gallery-card">
            <div class="module-gallery-card__top-strip"></div>
            <div class="module-gallery-card__body">
              <div class="module-gallery-card__top-row">
                <span class="module-pill module-pill--{{ module.category_key|default:'general'|slugify }}">{{ module.category_name }}</span>
                <span class="module-gallery-card__level">Basics</span>
              </div>

              <h3 class="module-gallery-card__title">{{ module.title }}</h3>
              <p class="module-gallery-card__desc">
                {% if module.description %}
                  {{ module.description }}
                {% else %}
                  No description available.
                {% endif %}
              </p>

              <p class="module-gallery-card__meta">
                <span class="module-gallery-card__meta-item">
                  <svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true" focusable="false">
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.7" fill="none"></circle>
                    <path d="M12 7.5v5.1l3.4 2.1" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"></path>
                  </svg>
                  {{ module.duration_label }}
                </span>
                <span aria-hidden="true">â€¢</span>
                <span class="module-gallery-card__meta-item">{{ module.lesson_label }}</span>
              </p>

              <a class="module-gallery-card__cta" href="{{ module.href }}">
                <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" focusable="false">
                  <path d="M8 6.4a1 1 0 0 1 1.5-.9l8 5.2a1.6 1.6 0 0 1 0 2.6l-8 5.2A1 1 0 0 1 8 17.6V6.4Z" fill="currentColor"></path>
                </svg>
                Start
              </a>
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="empty-state">No modules in this category yet.</p>
    {% endif %}
  </div>
</section>

{# Modules list section #}

{% endblock %}

{% block extra_js %}
  <script src="{% static 'resources/js/modules_gallery.js' %}" defer></script>
{% endblock %}
