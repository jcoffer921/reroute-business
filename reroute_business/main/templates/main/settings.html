{% extends "base.html" %}
{% load static %}

{% block title %}ReRoute | Account Settings{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/settings.css' %}">

<section class="settings-hero">
  <div class="settings-hero-content">
    <h1>Account Settings</h1>
    <p>Manage your account settings and preferences.</p>
  </div>
</section>

<div class="settings-grid">
  <!-- Left: Category cards -->
  <nav class="settings-nav" aria-label="Settings Categories">
    <h3 class="nav-group-label">Account</h3>
    <button class="nav-card active" data-panel="account">
      <span class="nav-icon" aria-hidden="true">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="8" r="3.5" stroke="#006da0" stroke-width="1.6"/>
          <path d="M5 20a7 7 0 0 1 14 0" stroke="#00beb8" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="nav-title">Account Preferences</span>
      <span class="nav-sub">Profile, email, general</span>
    </button>

    <button class="nav-card" data-panel="profile">
      <span class="nav-icon" aria-hidden="true">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 4a4 4 0 1 1 0 8 4 4 0 0 1 0-8z" stroke="#006da0" stroke-width="1.6"/>
          <path d="M4 20a8 8 0 0 1 16 0" stroke="#00beb8" stroke-width="1.6" stroke-linecap="round"/>
          <path d="M18 5.5h2.5M19.25 4.25v2.5" stroke="#006da0" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="nav-title">Profile Settings</span>
      <span class="nav-sub">Photo, background, about</span>
    </button>

    <button class="nav-card" data-panel="security">
      <span class="nav-icon" aria-hidden="true">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 3l8 4v5c0 5-3.5 9-8 9s-8-4-8-9V7l8-4z" stroke="#006da0" stroke-width="1.6"/>
          <path d="M9 13l2 2 4-4" stroke="#00beb8" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="nav-title">Sign In &amp; Security</span>
      <span class="nav-sub">Password, 2FA, recovery</span>
    </button>

    <h3 class="nav-group-label">Preferences</h3>
    <button class="nav-card" data-panel="billing">
      <span class="nav-icon" aria-hidden="true">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="6" width="18" height="12" rx="2" stroke="#006da0" stroke-width="1.6"/>
          <path d="M3 10h18" stroke="#00beb8" stroke-width="1.6"/>
        </svg>
      </span>
      <span class="nav-title">Billing</span>
      <span class="nav-sub">Subscription &amp; plans</span>
    </button>

    <button class="nav-card" data-panel="notifications">
      <span class="nav-icon" aria-hidden="true">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 9a6 6 0 0 1 12 0v4l1.5 2H4.5L6 13V9z" stroke="#006da0" stroke-width="1.6"/>
          <path d="M10 18a2 2 0 0 0 4 0" stroke="#00beb8" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="nav-title">Notifications</span>
      <span class="nav-sub">Emails, job updates, reminders</span>
    </button>
  </nav>


  <!-- Right: Panels -->
  <div class="settings-panels">
    <!-- Profile Settings Panel -->
    <section class="panel" id="panel-profile" aria-labelledby="tab-profile">
      <div
        id="profileSettingsData"
        data-avatar-upload-url="{% url 'dashboard:profile_avatar_upload' %}"
        data-avatar-delete-url="{% url 'dashboard:profile_avatar_delete' %}"
        data-background-url="{% url 'dashboard:profile_background_set' %}"
        data-details-url="{% url 'dashboard:profile_details_update' %}"
        data-bio-url="{% url 'dashboard:profile_bio_update' %}"
        data-experience-add-url="{% url 'dashboard:profile_experience_add' %}"
        data-skill-add-url="{% url 'dashboard:profile_skill_add' %}"
        data-language-add-url="{% url 'dashboard:profile_language_add' %}"
        data-experience-delete-base-url="{% url 'dashboard:profile_experience_delete' 0 %}"
        data-skill-delete-base-url="{% url 'dashboard:profile_skill_delete' 0 %}"
        data-language-delete-base-url="{% url 'dashboard:profile_language_delete' 0 %}"
        data-avatar-default-url="{% static 'images/default-avatar.png' %}"
        hidden
      ></div>

      <div class="settings-section">
        <h2 id="heading-profile-settings">Profile Settings</h2>
        <p class="help-text mt--4 text-gray-500">Update your profile photo, background, and private info.</p>
        <div class="profile-settings-grid">
          <div class="profile-avatar-block">
            <div class="avatar-shell">
              <img
                id="profileAvatarPreview"
                class="avatar-image"
                src="{% if profile_details.profile_picture %}{{ profile_details.profile_picture.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}"
                alt="Profile photo"
              >
              <button type="button" class="avatar-camera-btn" id="avatarUploadTrigger" aria-label="Change profile photo">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
                  <path d="M4 7h3l2-2h6l2 2h3v12H4V7z" stroke="#fff" stroke-width="1.6" stroke-linejoin="round"/>
                  <circle cx="12" cy="13" r="3.5" stroke="#fff" stroke-width="1.6"/>
                </svg>
              </button>
              <input type="file" id="profileAvatarInput" name="avatar" accept="image/*" hidden>
            </div>
            <button type="button" class="btn btn-secondary btn-pill btn-sm" id="avatarDeleteBtn">Delete Profile Picture</button>
            <p class="input-help">Upload a clear headshot (JPG, PNG, or GIF).</p>
          </div>

          <div class="profile-background-block">
            <label class="input-label">Change Background</label>
            <div class="background-picker">
              <div class="background-preview">
                <div id="profileBackgroundPreview" class="background-preview__swatch gradient-{% if profile_background_gradient %}{{ profile_background_gradient }}{% else %}aurora{% endif %}"></div>
                <div class="background-preview__label">Current background</div>
              </div>
              <div class="gradient-grid" role="listbox" aria-label="Background gradients">
                {% for key,label in profile_gradients %}
                  <button
                    type="button"
                    class="gradient-option {% if profile_background_gradient == key %}selected{% endif %}"
                    data-gradient="{{ key }}"
                    aria-pressed="{% if profile_background_gradient == key %}true{% else %}false{% endif %}"
                  >
                    <span class="gradient-chip gradient-{{ key }}" aria-hidden="true"></span>
                    <span class="gradient-label">{{ label }}</span>
                  </button>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <h3>Profile Details</h3>
        <form id="profileDetailsForm">
          {% csrf_token %}
          <div class="form-row-2">
            <div class="form-group">
              <label for="profile_first_name">First Name <span class="hint">(required)</span></label>
              <input type="text" id="profile_first_name" name="first_name" value="{{ profile_first_name }}" required>
            </div>
            <div class="form-group">
              <label for="profile_last_name">Last Name <span class="hint">(required)</span></label>
              <input type="text" id="profile_last_name" name="last_name" value="{{ profile_last_name }}" required>
            </div>
          </div>
          <div class="form-row-2">
            <div class="form-group">
              <label for="profile_email">Email</label>
              <input type="email" id="profile_email" name="email" value="{{ profile_email }}" {% if not email_change_allowed %}disabled{% endif %}>
              {% if not email_change_allowed %}
                <p class="input-help">Email changes are currently managed in Sign-in &amp; Security.</p>
              {% endif %}
            </div>
            <div class="form-group">
              <label for="profile_phone">Mobile Number</label>
              <input type="text" id="profile_phone" name="phone" value="{{ profile_phone }}" placeholder="(555) 555-5555">
            </div>
          </div>
          <div class="form-row-2">
            <div class="form-group">
              <label for="profile_gender">Gender</label>
              <select id="profile_gender" name="gender">
                <option value="">Select gender</option>
                {% for value,label in gender_choices %}
                  <option value="{{ value }}" {% if profile_gender == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label for="profile_user_id">User ID</label>
              <input type="text" id="profile_user_id" value="{{ profile_user_uid }}" disabled>
            </div>
          </div>
          <button type="submit" class="btn-primary btn-pill">Save Profile</button>
        </form>
      </div>

      <div class="settings-section">
        <div class="section-header-row">
          <h3>Who Am I?</h3>
          <button type="button" class="icon-btn" data-modal-open="bioModal" aria-label="Edit Who Am I">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
              <path d="M4 20h4l10-10-4-4L4 16v4z" stroke="#0f172a" stroke-width="1.6" stroke-linejoin="round"/>
              <path d="M13 6l4 4" stroke="#0f172a" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        <p id="profileBioText" class="profile-bio-text">
          {% if profile_bio %}{{ profile_bio }}{% else %}<em>No bio yet.</em>{% endif %}
        </p>
      </div>

      <div class="settings-section">
        <div class="section-header-row">
          <h3>Experience / Skills / Languages</h3>
          <button type="button" class="icon-btn" data-modal-open="eslModal" aria-label="Edit experience, skills, and languages">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
              <path d="M4 20h4l10-10-4-4L4 16v4z" stroke="#0f172a" stroke-width="1.6" stroke-linejoin="round"/>
              <path d="M13 6l4 4" stroke="#0f172a" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        <div class="profile-esl-summary">
          <div class="summary-block">
            <h4>Skills</h4>
            <div class="pill-wrap" id="profileSkillsPreview">
              {% for skill in profile_skills %}
                <span class="pill-chip">{{ skill.name }}</span>
              {% empty %}
                <span class="muted">No skills yet.</span>
              {% endfor %}
            </div>
          </div>
          <div class="summary-block">
            <h4>Languages</h4>
            <div class="pill-wrap" id="profileLanguagesPreview">
              {% for language in profile_languages %}
                <span class="pill-chip">{{ language.name }}</span>
              {% empty %}
                <span class="muted">No languages yet.</span>
              {% endfor %}
            </div>
          </div>
          <div class="summary-block">
            <h4>Experience</h4>
            <p class="muted">{% if profile_experiences %}{{ profile_experiences|length }} entries{% else %}No experience added yet.{% endif %}</p>
          </div>
        </div>
      </div>

      <!-- Who Am I Modal -->
      <div class="settings-modal" id="bioModal" role="dialog" aria-modal="true" aria-labelledby="bioModalTitle" hidden>
        <div class="settings-modal__dialog">
          <button type="button" class="settings-modal__close" data-modal-close aria-label="Close">×</button>
          <h3 id="bioModalTitle">Who Am I?</h3>
          <form id="bioForm">
            {% csrf_token %}
            <textarea id="bioTextarea" name="bio" rows="6" maxlength="600" placeholder="Share a short intro about yourself.">{{ profile_bio }}</textarea>
            <div class="modal-actions">
              <button type="button" class="btn btn-secondary btn-pill" data-modal-close>Cancel</button>
              <button type="submit" class="btn btn-primary btn-pill">Save</button>
            </div>
            <div class="char-counter" id="bioCharCounter">0 / 600</div>
          </form>
        </div>
      </div>

      <!-- Experience / Skills / Languages Modal -->
      <div class="settings-modal" id="eslModal" role="dialog" aria-modal="true" aria-labelledby="eslModalTitle" hidden>
        <div class="settings-modal__dialog settings-modal__dialog--wide">
          <button type="button" class="settings-modal__close" data-modal-close aria-label="Close">×</button>
          <h3 id="eslModalTitle">Experience / Skills / Languages</h3>
          <div class="esl-grid">
            <section class="esl-section">
              <h4>Experience</h4>
              <div id="experienceList" class="experience-list">
                {% for exp in profile_experiences %}
                  <div class="experience-item" data-experience-id="{{ exp.id }}">
                    <div class="experience-main">
                      <div class="experience-title">{{ exp.job_title }}</div>
                      <div class="experience-meta">
                        {{ exp.company }}
                        • {{ exp.start_date|date:"M Y" }}
                        {% if exp.end_date %}— {{ exp.end_date|date:"M Y" }}{% elif exp.currently_work_here %}— Present{% endif %}
                      </div>
                      {% if exp.description %}
                        <div class="experience-desc">{{ exp.description }}</div>
                      {% endif %}
                    </div>
                    <button type="button" class="icon-btn icon-btn--danger" data-experience-delete="{{ exp.id }}" aria-label="Delete experience">×</button>
                  </div>
                {% empty %}
                  <p class="muted">No experience added yet.</p>
                {% endfor %}
              </div>
              <form id="experienceForm" class="experience-form">
                {% csrf_token %}
                <div class="form-row-2">
                  <div class="form-group">
                    <label for="experienceJobTitle">Job Title</label>
                    <input type="text" id="experienceJobTitle" name="job_title" required>
                  </div>
                  <div class="form-group">
                    <label for="experienceCompany">Company</label>
                    <input type="text" id="experienceCompany" name="company" required>
                  </div>
                </div>
                <div class="form-row-2">
                  <div class="form-group">
                    <label for="experienceStart">Start Date</label>
                    <input type="date" id="experienceStart" name="start_date" required>
                  </div>
                  <div class="form-group">
                    <label for="experienceEnd">End Date</label>
                    <input type="date" id="experienceEnd" name="end_date">
                  </div>
                </div>
                <div class="form-group inline-check">
                  <label for="experienceCurrent">
                    <input type="checkbox" id="experienceCurrent" name="currently_work_here">
                    Currently work here
                  </label>
                </div>
                <div class="form-group">
                  <label for="experienceDescription">Description (optional)</label>
                  <textarea id="experienceDescription" name="description" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-pill">Add Experience</button>
              </form>
            </section>

            <section class="esl-section">
              <h4>Skills</h4>
              <div class="pill-editor">
                <div id="skillsPills" class="pill-wrap">
                  {% for skill in profile_skills %}
                    <span class="pill-chip pill-chip--editable" data-skill-id="{{ skill.id }}" data-skill-name="{{ skill.name }}">
                      {{ skill.name }}
                      <button type="button" class="pill-remove" data-skill-remove="{{ skill.id }}" aria-label="Remove {{ skill.name }}">×</button>
                    </span>
                  {% empty %}
                    <span class="muted">No skills yet.</span>
                  {% endfor %}
                </div>
                <div class="pill-input-row">
                  <input type="text" id="skillInput" maxlength="40" placeholder="Add a skill">
                  <button type="button" class="btn btn-secondary btn-pill" id="skillAddBtn">Add</button>
                </div>
              </div>
            </section>

            <section class="esl-section">
              <h4>Languages</h4>
              <div class="pill-editor">
                <div id="languagesPills" class="pill-wrap">
                  {% for language in profile_languages %}
                    <span class="pill-chip pill-chip--editable" data-language-id="{{ language.id }}" data-language-name="{{ language.name }}">
                      {{ language.name }}
                      <button type="button" class="pill-remove" data-language-remove="{{ language.id }}" aria-label="Remove {{ language.name }}">×</button>
                    </span>
                  {% empty %}
                    <span class="muted">No languages yet.</span>
                  {% endfor %}
                </div>
                <div class="pill-input-row">
                  <input type="text" id="languageInput" maxlength="40" placeholder="Add a language">
                  <button type="button" class="btn btn-secondary btn-pill" id="languageAddBtn">Add</button>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </section>

    <!-- Account Panel -->
    <section class="panel active" id="panel-account" aria-labelledby="tab-account">
      {# Subscription moved to Billing panel #}

      <!-- Account Preferences: Username, Display Name, Employment Status -->
      <div class="settings-section">
        <h2 id="heading-account-prefs">Account Preferences</h2>
        <p class="help-text mt--4 text-gray-500">Choose how your name appears and update your availability.</p>
        <form method="POST" aria-labelledby="heading-account-prefs">
          {% csrf_token %}
          <div class="form-row-2">
            <div class="form-group">
              <label for="id_username">Username <span class="hint">(system ID)</span></label>
              {{ account_prefs_form.username }}
              <p class="input-help">Used for login; cannot be changed frequently.</p>
            </div>
            <div class="form-group">
              <label for="id_display_name">Display Name</label>
              {{ account_prefs_form.display_name }}
              <p class="input-help">Public-facing name shown to employers and users.</p>
            </div>
          </div>
          <div class="form-group">
            <label for="id_status">Employment Status</label>
            {{ account_prefs_form.status }}
          </div>
          <button type="submit" name="update_account_prefs" class="btn-primary btn-pill">Save Preferences</button>
        </form>
      </div>

      <!-- Change Email -->
      <div class="settings-section">
        <h2 id="heading-change-email">Change Email</h2>
        <form method="POST" aria-labelledby="heading-change-email">
          {% csrf_token %}
          <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" name="email" id="email" class="input-small" value="{{ request.user.email }}" placeholder="Email Address" autocomplete="email" required>
          </div>
          <button type="submit" name="update_email" class="btn-primary btn-pill">Change Email</button>
        </form>
      </div>

      <!-- Account Management -->
      <div class="settings-box danger-zone">
        <h3 id="heading-account-mgmt">Account Management</h3>
        <form method="POST" aria-labelledby="heading-account-mgmt">
          {% csrf_token %}
          <div class="button-row">
            <button type="submit" name="deactivate_account" class="btn btn-secondary btn-pill">Deactivate Account</button>
            <button type="submit" name="delete_account" class="btn btn-danger btn-pill" onclick="return confirm('Are you sure? This will permanently delete your account.')">Delete Account</button>
          </div>
        </form>
      </div>
    </section>

    <!-- Security Panel -->
    <section class="panel" id="panel-security" aria-labelledby="tab-security">
      <div class="settings-section">
        <h2 id="heading-change-password">Change Password</h2>
        <form method="POST" aria-labelledby="heading-change-password">
          {% csrf_token %}
          <div class="form-group">
            <label for="id_old_password">Current Password</label>
            {{ password_form.old_password }}
          </div>
          <div class="form-group">
            <label for="id_new_password1">New Password</label>
            {{ password_form.new_password1 }}
          </div>
          <div class="form-group">
            <label for="id_new_password2">Confirm Password</label>
            {{ password_form.new_password2 }}
          </div>
          <button type="submit" name="change_password" class="btn-primary btn-pill">Change Password</button>
        </form>
      </div>

      <div class="settings-section">
        <h2>Two-Factor Authentication</h2>
        <form>
          <div class="form-group" style="flex-direction:row; align-items:center; justify-content:space-between;">
            <label for="twofa">Enable 2FA (Coming Soon)</label>
            <input id="twofa" type="checkbox" disabled>
          </div>
          <button type="button" class="btn btn-secondary btn-pill" disabled>Configure 2FA</button>
        </form>
      </div>

      <!-- Recovery Options -->
      <div class="settings-section">
        <h2 id="heading-recovery">Recovery Options</h2>
        <p class="help-text" style="margin-top:-4px; color:#6b7280;">Add a backup email or phone number so you can recover access if you lose your password or device.</p>
        <form id="recoveryForm" method="POST" aria-labelledby="heading-recovery">
          {% csrf_token %}
          <div class="form-row-2">
            <div class="form-group">
              <label for="id_backup_email">Backup Email</label>
              {{ recovery_form.backup_email }}
            </div>
            <div class="form-group">
              <label for="id_backup_phone">Backup Phone</label>
              {{ recovery_form.backup_phone }}
            </div>
          </div>
          <button type="submit" name="update_recovery" class="btn-primary btn-pill">Save Recovery Options</button>
        </form>
      </div>
    </section>

    <!-- Notifications Panel -->
    <section class="panel" id="panel-notifications" aria-labelledby="tab-notifications">
      <div class="settings-section">
        <h2>Email Notifications</h2>
        <form class="notify-form">
          <div class="notify-row">
            <div class="notify-text">
              <label for="alerts-jobs" class="notify-label">Job updates</label>
              <p class="notify-help">Get notified when new jobs match your preferences.</p>
            </div>
            <label class="toggle">
              <input id="alerts-jobs" type="checkbox" checked>
              <span class="slider"></span>
            </label>
          </div>

          <div class="notify-row">
            <div class="notify-text">
              <label for="alerts-reminders" class="notify-label">Reminders</label>
              <p class="notify-help">Receive reminders for saved jobs and upcoming deadlines.</p>
            </div>
            <label class="toggle">
              <input id="alerts-reminders" type="checkbox" checked>
              <span class="slider"></span>
            </label>
          </div>

          <div class="notify-row">
            <div class="notify-text">
              <label for="alerts-news" class="notify-label">News &amp; tips</label>
              <p class="notify-help">Occasional product updates and career tips.</p>
            </div>
            <label class="toggle">
              <input id="alerts-news" type="checkbox">
              <span class="slider"></span>
            </label>
          </div>

          <div class="notify-actions">
            <button type="button" class="btn btn-secondary btn-pill btn-sm" disabled>Save Preferences</button>
          </div>
        </form>
      </div>
    </section>

    <!-- Billing Panel -->
    <section class="panel" id="panel-billing" aria-labelledby="tab-billing">
      <div class="settings-section settings-section--flat">
        <div class="settings-card" role="region" aria-labelledby="heading-subscription">
          <div class="settings-card__head">
            <h3 id="heading-subscription" class="settings-card__title">Subscription</h3>
          </div>
          <div class="kv">
            <div class="kv__row">
              <div class="kv__label">Current Plan</div>
              <div class="kv__value plan-name">
                {{ subscription.plan_name }}
                {% if is_employer and subscription.plan_name|lower in 'basic pro enterprise' %}
                  <span class="pill pill--ok" style="margin-left:8px;">Current</span>
                {% endif %}
              </div>
            </div>
            <div class="kv__row">
              <div class="kv__label">Status</div>
              <div class="kv__value">
                <span class="pill {% if subscription.active %}pill--ok{% else %}pill--warn{% endif %}">
                  {% if subscription.active %}Active{% else %}Inactive{% endif %}
                </span>
              </div>
            </div>
            {% if is_employer and subscription.expiry_date %}
            <div class="kv__row">
              <div class="kv__label">Next Billing Date</div>
              <div class="kv__value">{{ subscription.expiry_date|date:"F j, Y" }}</div>
            </div>
            {% endif %}
          </div>
          <div class="settings-card__actions settings-card__actions--footer">
            <a href="{{ subscription_pricing_url }}" class="btn btn-primary btn-pill" {% if is_employer and not is_verified %}aria-disabled="true" data-disabled="true"{% endif %}>
              {% if is_employer %}
                {% if is_employer and subscription.plan_name|lower in 'basic pro enterprise' %}
                  Manage Plan
                {% else %}
                  Choose a Plan
                {% endif %}
              {% else %}
                View Plans
              {% endif %}
            </a>
            {% if is_employer %}
            <form method="post" action="{% url 'profiles:cancel_subscription' %}" onsubmit="return confirm('Cancel your subscription and revert to Free?');">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-pill">Cancel Subscription</button>
            </form>
            {% endif %}
          </div>
        </div>
        {% if is_employer and not is_verified %}
          <p class="help-text" style="margin-top: 0.75rem; color:#b45309;">Your account must be verified before upgrading your plan.</p>
        {% endif %}
      </div>
    </section>
  </div>
</div>

<!-- Support CTA under everything -->
<div class="support-card">
  <p class="support-text">Can't find what you're looking for?</p>
  <a href="{% url 'contact' %}" class="btn btn-outline btn-pill btn-sm">Ask Support</a>
</div>

{% block extra_js %}
  <script src="{% static 'js/settings_page.js' %}" defer></script>
  <script src="{% static 'js/settings_profile.js' %}" defer></script>
{% endblock %}
{% endblock %}
