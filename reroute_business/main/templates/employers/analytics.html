{% extends "base.html" %}
{% load static %}

{% block title %}Employer Analytics{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'dashboard/css/admin_dashboard.css' %}">

<section class="admin-hero">
  <div class="admin-hero-content">
    <h1>Employer Analytics</h1>
    <p>Interactive metrics for your jobs and applicants</p>
  </div>
  <div class="mt-8">
    <a href="{% url 'dashboard:employer' %}" class="btn btn-secondary btn-sm">Back to Employer Dashboard</a>
  </div>
</section>

<div class="admin-dashboard">
  <div class="stats-grid">
    <div class="stat-box">
      <div class="stat-box__label">Jobs Posted</div>
      <div class="stat-box__value">{{ total_jobs }}</div>
    </div>
    <div class="stat-box">
      <div class="stat-box__label">Active Jobs</div>
      <div class="stat-box__value">{{ active_jobs }}</div>
    </div>
    <div class="stat-box">
      <div class="stat-box__label">Applications</div>
      <div class="stat-box__value">{{ total_applications }}</div>
    </div>
    <div class="stat-box">
      <div class="stat-box__label">Jobs Filled</div>
      <div class="stat-box__value">{{ jobs_filled }}</div>
    </div>
  </div>

  <div class="section-header d-flex jc-between ai-center mt-16">
    <h2 class="m-0">Charts</h2>
    <form method="get" class="d-flex gap-8 ai-center">
      <label for="time_range">Range:</label>
      <select id="time_range" name="time_range">
        <option value="7d" {% if time_range == '7d' %}selected{% endif %}>7 days</option>
        <option value="30d" {% if time_range == '30d' %}selected{% endif %}>30 days</option>
        <option value="all" {% if time_range == 'all' %}selected{% endif %}>All time</option>
      </select>
    </form>
  </div>

  <div class="charts-grid">
    <section>
      <h2>Applications per Job</h2>
      <div id="appsPerJob" class="chart-sm"></div>
    </section>
    <section>
      <h2>Applications Over Time</h2>
      <div id="appsOverTime" class="chart-sm"></div>
    </section>
    <section class="grid-span-2">
      <h2>Application Status Breakdown</h2>
      <div id="statusBreakdown" class="chart-sm"></div>
    </section>
  </div>

  <section class="mt-16">
    <h2>Recent Jobs</h2>
    <div class="table-responsive">
      <table>
        <tr>
          <th>Title</th>
          <th>Status</th>
          <th>Created</th>
        </tr>
        {% for j in jobs %}
        <tr>
          <td>{{ j.title }}</td>
          <td>{{ j.is_active|yesno:"Active,Inactive" }}</td>
          <td>{{ j.created_at|date:"M d, Y" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="3">No jobs yet.</td></tr>
        {% endfor %}
      </table>
    </div>
  </section>
</div>

<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<script id="emp-analytics-data" type="application/json">{{ chart_bootstrap|default:'{}'|safe }}</script>
<script src="{% static 'js/employers_analytics.js' %}" defer></script>
{% endblock %}
