{% extends "admin_portal/base.html" %}

{% block admin_content %}
<header>
  <div class="admin-page-title">What needs attention right now</div>
  <p class="admin-subtitle">Operational health for the last 7 days.</p>
</header>

<section class="admin-cards">
  <a class="admin-card" href="{% url 'admin_portal:user_list' %}">
    <h3>Active users (7d)</h3>
    <div class="stat">{{ active_users_7|default:0 }}</div>
    <div class="sub">Login activity in the last week</div>
  </a>
  <a class="admin-card" href="{% url 'admin_portal:job_list' %}?status=flagged">
    <h3>Jobs pending review</h3>
    <div class="stat">{{ jobs_pending_review|default:0 }}</div>
    <div class="sub">Flagged for policy review</div>
  </a>
  <a class="admin-card" href="{% url 'admin_portal:employer_list' %}?status=pending">
    <h3>Employers awaiting approval</h3>
    <div class="stat">{{ employers_pending|default:0 }}</div>
    <div class="sub">Manual verification queue</div>
  </a>
  <a class="admin-card" href="{% url 'admin_portal:job_list' %}?status=flagged">
    <h3>Open flags</h3>
    <div class="stat">{{ open_flags|default:0 }}</div>
    <div class="sub">Reports &amp; trust issues</div>
  </a>
  <a class="admin-card" href="{% url 'admin_portal:org_application_list' %}?status=pending">
    <h3>Org applications pending</h3>
    <div class="stat">{{ org_apps_pending|default:0 }}</div>
    <div class="sub">Submitted partner applications</div>
  </a>
  <a class="admin-card" href="{% url 'admin_portal:audit_log' %}">
    <h3>Site views</h3>
    <div class="stat">{{ site_views_7|default:0 }}</div>
    <div class="sub">Page views (7d)</div>
  </a>
</section>

<section class="admin-section">
  <div class="admin-section-header">
    <div class="admin-section-title">Urgent Review Queue</div>
  </div>
  {% if review_queue %}
  <div class="admin-list">
    {% for item in review_queue %}
    <a class="admin-list-item" href="{{ item.url }}">
      <span class="admin-list-icon {% if item.severity == 'high' %}is-high{% elif item.severity == 'medium' %}is-medium{% endif %}">
        {% if item.severity == 'high' %}
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M12 3l9 16H3z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
        {% else %}
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><circle cx="12" cy="12" r="9"/><path d="M12 8v5"/><path d="M12 16h.01"/></svg>
        {% endif %}
      </span>
      <div class="admin-list-meta">
        <h4>{{ item.title }}</h4>
        <p>{{ item.reason }}</p>
      </div>
      <span class="admin-list-time">{% if item.timestamp %}{{ item.timestamp|date:"M d" }}{% endif %}</span>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <p class="admin-subtitle">No urgent items right now.</p>
  {% endif %}
</section>

<section class="admin-section">
  <div class="admin-section-header">
    <div class="admin-section-title">Recent Activity</div>
  </div>
  {% if activity_items %}
  <div class="admin-feed">
    {% for item in activity_items %}
    <div class="admin-feed-item">
      <div>
        <strong>{{ item.title }}</strong>
        <p>{{ item.detail }}</p>
      </div>
      <span class="admin-list-time">{% if item.timestamp %}{{ item.timestamp|date:"M d, g:ia" }}{% endif %}</span>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="admin-subtitle">No recent activity logged.</p>
  {% endif %}
</section>
{% endblock %}
